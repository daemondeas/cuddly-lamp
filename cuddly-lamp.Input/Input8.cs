using Microsoft.FSharp.Collections;

namespace cuddly_lamp.Input;
public class Input8 : AbstractInput<(int, int, IReadOnlyDictionary<char, FSharpList<Tuple<int, int>>>), IReadOnlyDictionary<char, FSharpList<Tuple<int, int>>>>
{
  protected override (int, int, IReadOnlyDictionary<char, FSharpList<Tuple<int, int>>>) FormatFirst(string input)
  {
    var rows = input.Split('\n');
    var y = rows.Length;
    var x = rows[0].Length;
    var keys = input.Where(c => c != '\n' && c != '.');
    var result = new Dictionary<char, List<(int, int)>>(keys.Count());
    foreach (var key in keys)
    {
      result[key] = new List<(int, int)>();
    }

    for (var i = 0; i < y; i++)
    {
      for (var j = 0; j < x; j++)
      {
        if (rows[i][j] != '.')
        {
          result[rows[i][j]].Add((j, i));
        }
      }
    }

    var convertedResult = new Dictionary<char, FSharpList<Tuple<int, int>>>(result.Count());
    foreach (var key in result.Keys)
    {
      convertedResult[key] = ListModule.OfSeq(result[key].Select(v => v.ToTuple()));
    }

    return (x, y, convertedResult);
  }

  protected override IReadOnlyDictionary<char, FSharpList<Tuple<int, int>>> FormatSecond(string input)
  {
    throw new NotImplementedException();
  }

  public override string TestInput => @"............
........0...
.....0......
.......0....
....0.......
......A.....
............
............
........A...
.........A..
............
............";

  public override string RealInput => @"...s..............................................
...................w......K.......t...............
........s.........................................
.......s......w...............1...................
.........w5.......................................
.......................t.F........................
..................................................
F................................1...........d....
.........................5......................K.
............5.................R..............KZ...
....F.....q.........w..............1.....t........
............8.......I.............................
..........8.................t....................K
...........8.................5.....Z..............
.........q..............................Z...d..U..
...................Y.q...R........................
....................E.....z...............y.......
..........................................U.......
.....F.................................k........S.
............q...................d.................
.................................R................
..x....................................U.........y
.......x.........................E..M...U..d......
......z.......X............................4......
...............I....m....M......R............y....
.......z...................................k..e...
..f..z.......................................e....
...f.I..........7..u..........M................D..
.......X..I.......x.................k.............
.........X.......7....................4.......S...
....................u9...T.....3.Z....o..........6
........f.......D..3....u..................S......
...W...0.........................................D
.....................T................E.......m...
...8....Y............f........T4..................
......Y...........................................
....0.............3...............................
....................3.T.....................k.....
.......................u..............6...........
...........................6..........9........e..
..................4....7.............o..........D.
.................................M...E..o.........
...i.................O...........................Q
.....0.i.....................................m.2..
.......Y.r........7..............S..O..2.......m..
.....r......0.............O.......................
..................................Q...............
........................6................o......Q.
..W...r.................................9.........
.W.........................O........2.............";
}

